# 自動テストのアーキテクチャとその理由

<https://layerx.connpass.com/event/370228/> に参加。以下ざっくりメモ。

- なぜやろうと思ったか
  - 「JSTQB ALシラバス自動化エンジニア」ではgTAAやTAAなど、アーキテクチャ例が紹介されているが、実践例はなかなか見つからない
  - サービスと密結合になり一般化がしづらい

## LINEヤフー

- QAチーム誕生の経緯
  - 一部のプロジェクト群ではQAチームが自動テストの導入を推進していたが、実行環境の構築に共通の課題を抱えていた。
  - テスト実装面では、ノーコードツールであるMagicPodの全社導入により標準化が進み、課題は概ね解消
  - 一方で、実行環境の課題は残存していた。
- 自動テストプラットフォーム
  - 主な役割は実行環境基盤・通知系統の提供
  - E2EテストとAPIテストがターゲット
  - 主に全社のQA/テストチーム部門が扱う
- 動作の流れ
  - 1.setup:利用するプロジェクト群でCI Jobsの作成・実行Confファイルなどを作成してGHEに記載
  - 2.create env:CI Jobsが実行され、VM Server or iMacでインスタントな実行環境が構築される
  - 3.execute:テスト実行をする
  - 4:report:実行完了後、結果をテスト管理ツールに書き込み、Slackへ通知する
- プラットフォームの安定運用の課題
  - 最初は一部に導入していたが、次第に利用ニーズが広がり全社に展開
  - 課題
    - SLAがない
    - 検証環境がない
    - モニタリング不整備
    - ソースコードのメンテナンス性が担保されていない
  - 各課題に対して品質向上のため組織作りを実施
- 異なる環境での共通化の課題
  - 旧ヤフープロダクト向けにも展開したいが、ネットワーク系統の差異による障壁
  - 共通環境移行、ネットワークゲートウェイ接続の検討したが、ハードルの低さからローカル実行環境を構築することを採用
  - 継続的な提供を優先し、現実界で突破することが重要

## OSK

- プログラマ。QAエンジニアではない。
- システムアーキテクチャとは
  - システムの構造や構造化の原則
- システムアーキテクチャの目的
  - システムの品質特性を強制（支配）する構造を構築する
- 品質特性の具体化手順
  - 品質特性に対するステークホルダーを明確化する
- 自動テストを頑張ってもテスト対象システムがテストしにくい構造だと無理なものは無理
- テスト対象システムに要求される品質特性
- 自動テストシステムに要求される品質特性
  - 安定性
  - 信頼性
  - 移植性
- システムテストを実装の束縛から解放する
  - テストケース定義を実装に依存させない
- キーワード駆動システムテスト
  - 論理的なキーワードを用いて記述されたテストケースをツールが解釈し、テスト対象を操作するテスト
  - 操作として、値の設定以外に状態や値の取得を提供する
  - 写像のように1:1関係で操作できるシステム構築を行う
- 例:SelemiunやAppiumなどをエンジンとしたシステムテスト実行モジュール
  - Markdownでテストケースを整備

## セガ

- 大規模ゲーム開発における自動化テストの目的と流れ
  - QCD（Quality/Cost/Delivery）への貢献
  - ゲームを面白くするための作業に集中
  - 納期に間に合わせるために時間的コストを削減
- Unit/Integration/E2E→上位になる程高コスト（ピラミッド）
- Unit/IntegrationはJenkinsで実行
  - ゲームの規模によりGitHub上に全て置けない
  - パッケージは100GBを超えることもある
  - Gitだとバイナリ管理が辛い
  - データそのものをテストしたいのでソースコードと一緒にまとめる必要がある
- 自動プレイの仕組み
  - Pythonで実行するとゲーム内のデバッグ機能と通信して実行
  - ゲーム内組み込み型（1フレーム単位の操作）とサーバークライアント型（UIや移動の操作）のハイブリッド
- 　デバイスファームは物理で実行
  - リリースするプラットフォームでテストすべき（勿論クラウド上でも可能ではある）
- テスト結果の見える化
  - 単体テストと自動プレイでは見たい結果の範囲が異なる
    - 単体:成功/失敗とメッセージだけでも事足りる
    - 自動プレイ:ワールドマップ上でのプロットやヒートマップ、シナリオの進行状況なども必要
  - リリース後のDLC配信期間はCSサポートの人も自動テストの結果を見ることがあるので詳細に出力

## LayerX

- E2E Scenario Testについて
- アーキテクチャ概要
  - コアはPlaywrightで構成
  - 複数アプリケーションのE2Eシナリオテストをまとめた専用リポジトリ
  - Playwrightの設定ファイルやユーティリティメソッドなどと、テストシナリオのスクリプトが同じリポジトリに存在している
- 実行環境はローカル or AWS CodePipeline&CodeBuild
