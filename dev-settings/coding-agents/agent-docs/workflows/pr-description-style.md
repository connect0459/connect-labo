# PR説明スタイルガイド

## 概要

Pull Request (PR) の説明は、レビュワーが変更内容を理解し、適切にレビューするための重要なドキュメントです。
**既存PRのスタイルを参照**し、プロジェクト固有のフォーマット規則を尊重することが重要です。

## 基本原則

### 1. 既存スタイルの踏襲

新しいPRを作成する前に、**マージ済みPRを3-5件確認**し、スタイルパターンを把握します。

```bash
# 最近マージされたPRを確認
gh pr list --state merged --limit 5

# 特定PRの説明を確認
gh pr view 123
```

確認ポイント:

- タイトルのフォーマット（prefix、記号の使い方等）
- 本文の構造（セクション、箇条書き等）
- 装飾の使い方（太字、イタリック、コード記法等）
- 関連PR/issueの参照方法

### 2. ユーザー固有の規則を尊重

プロジェクトやユーザーによって以下のような固有ルールが存在します:

- 太字の使用禁止
- コロン装飾の禁止
- 特定のセクション構造
- 敬体/常体の統一
- 絵文字の使用/不使用

### 3. 簡潔さと明確さのバランス

- 冗長な説明は避ける
- 必要な情報は漏らさない
- 箇条書きで構造化

## PRタイトルの作成

### フォーマット

一般的なフォーマット:

```text
[type] 変更の要約（70文字以内）
```

例:

```text
feat: ユーザープロフィール編集機能を追加
fix: ログイン時のセッション切れ問題を修正
refactor: バリデーションロジックをドメイン層に移動
docs: READMEにAPI仕様を追加
```

### タイプの例

- `feat`: 新機能
- `fix`: バグ修正
- `refactor`: リファクタリング
- `docs`: ドキュメント
- `test`: テスト追加・修正
- `chore`: ビルド、設定等

### タイトルのポイント

- **簡潔に**: 70文字以内
- **具体的に**: 何を変更したか明確に
- **ユーザー視点**: 技術詳細より変更の意図

❌ 避けるべき:

```text
Update files
Fix bug
Refactoring
```

✅ 推奨:

```text
fix: 決済時のタイムアウトエラーを修正
refactor: ユーザー認証ロジックを認証サービスに集約
```

## PR本文の構造

### 基本テンプレート

```markdown
## 概要

[変更の背景と目的を2-3文で説明]

## 変更内容

- [変更点1]
- [変更点2]
- [変更点3]

## 影響範囲

- [影響を受けるコンポーネント/機能]

## テスト

- [テスト方法と結果]

## 関連

- Fixes #123
- Related to #456
```

### セクション別ガイド

#### 概要セクション

**目的**: レビュワーが変更の背景を理解する

```markdown
## 概要

ゲストユーザーが会員登録せずに購入できる機能を追加しました。
これにより、初回購入のハードルを下げ、コンバージョン率の向上を目指します。
```

ポイント:

- Why（なぜこの変更が必要か）
- What（何を変更したか）
- 2-3文で簡潔に

#### 変更内容

**目的**: 具体的な変更を箇条書きで列挙

```markdown
## 変更内容

- ゲストチェックアウト用の新規エンドポイント追加
- ゲスト情報を一時保存するセッション管理実装
- 決済完了後の会員登録誘導フロー追加
- ゲストユーザー向けのバリデーションルール追加
```

ポイント:

- 箇条書きで構造化
- 技術的な変更を具体的に記述
- 変更が多い場合はカテゴリで分類

#### 影響範囲

**目的**: レビュワーが影響を把握する

```markdown
## 影響範囲

- チェックアウトフロー全体
- ユーザー認証ロジック
- 決済処理（ゲスト/会員の分岐追加）
- メール通知（ゲスト用テンプレート追加）
```

#### テスト

**目的**: 動作検証が適切に行われたことを示す

```markdown
## テスト

- ユニットテスト: 新規追加15件、既存テスト全てパス
- 手動テスト:
  - ゲストとしてチェックアウトフロー完遂
  - 決済完了後の会員登録フローの動作確認
  - エラーケース（無効な入力、決済失敗等）の確認
```

#### 関連

**目的**: 関連するissue/PRとの紐付け

```markdown
## 関連

- Fixes #123 （このPRでクローズされるissue）
- Related to #456 （関連するが、このPRではクローズしないissue）
- Based on #789 （このPRが依存するPR）
```

## スタイルガイド

### 装飾の使い方

#### 太字

プロジェクトによって使用ルールが異なります。

**既存PRで太字が使われていない場合は使用しない**:

❌ 避けるべき:

```markdown
**重要**: この変更は後方互換性がありません
```

✅ 推奨:

```markdown
重要: この変更は後方互換性がありません
```

#### コード記法

ファイル名、関数名、変数名等に使用:

```markdown
`UserService` クラスに `validateEmail` メソッドを追加
```

#### リスト

箇条書きは `-` を使用（統一性のため）:

```markdown
- 項目1
- 項目2
  - サブ項目
```

### 段落の区切り

適切な空行で可読性を向上:

```markdown
## 変更内容

ユーザー認証ロジックを改善しました。

以下の3つの変更を行いました:

- パスワードハッシュアルゴリズムをbcryptに変更
- セッション有効期限を7日間に延長
- 多要素認証のサポートを追加
```

## よくある間違い

### 1. 技術詳細の過剰説明

❌ 避けるべき:

```markdown
src/services/UserService.tsの42行目でvalidateEmail関数を定義し、
正規表現/^[^\s@]+@[^\s@]+\.[^\s@]+$/を使用してメールアドレスの
バリデーションを実装しました。
```

✅ 推奨:

```markdown
メールアドレスのバリデーション機能を追加
```

### 2. 変更の羅列のみ

❌ 避けるべき:

```markdown
- UserService.ts 修正
- user.test.ts 追加
- README 更新
```

✅ 推奨:

```markdown
## 変更内容

- ユーザー登録時のメールアドレスバリデーション追加
- バリデーションロジックのテスト追加
- READMEにAPI仕様を追加
```

### 3. 背景説明の欠如

❌ 避けるべき:

```markdown
バリデーションを追加しました。
```

✅ 推奨:

```markdown
## 概要

不正なメールアドレスでの登録が可能だった問題を修正しました。
RFC 5322に準拠したバリデーションを実装し、データ品質を向上させます。
```

## Coding Agentでの実践

### PR説明ドラフトの依頼

```text
current branchとmainの差分からPR説明を作成してください。

以下の手順でお願いします:
1. 最近マージされた3件のPRを読んで、私のスタイルを把握
2. diffを確認して変更内容を理解
3. 私のスタイルに合わせてPR説明をドラフト
4. tmp/pr-body.md に出力
5. 確認後、gh pr createを実行
```

### スタイル指定の例

既存PRのスタイルが不明な場合、明示的に指定:

```text
PR説明を作成してください。

フォーマット規則:
- 太字不使用
- コロン装飾なし
- 箇条書きは `-` を使用
- セクション: 概要、変更内容、テスト、関連
```

## チェックリスト

PR説明作成時のチェックリスト:

- [ ] タイトルが70文字以内
- [ ] タイトルがtypeを含む（feat/fix/refactor等）
- [ ] 概要セクションで背景と目的を説明
- [ ] 変更内容が箇条書きで明確
- [ ] 影響範囲を記載
- [ ] テスト方法と結果を記載
- [ ] 関連issue/PRを紐付け
- [ ] 既存PRのスタイルに準拠
- [ ] 装飾（太字、コロン等）がプロジェクト規則に従っている
- [ ] 誤字脱字がない

## スタイルサンプル

### シンプルスタイル

```markdown
## 概要

ユーザープロフィール編集機能を追加しました。

## 変更内容

- プロフィール編集フォームの実装
- アバター画像アップロード機能
- バリデーションルール追加

## テスト

ユニットテスト追加、手動テストで動作確認済み

## 関連

Fixes #123
```

### 詳細スタイル

```markdown
## 概要

ユーザーがプロフィール情報を編集できる機能を追加しました。
現在は管理画面からのみ編集可能でしたが、ユーザー自身で編集できるようにすることで、
情報の鮮度を保ち、ユーザー体験を向上させます。

## 変更内容

### フロントエンド

- プロフィール編集ページの追加
- アバター画像のアップロード機能
- リアルタイムバリデーション

### バックエンド

- プロフィール更新API追加
- 画像アップロードエンドポイント追加
- バリデーションルール実装

### テスト

- ユニットテスト 15件追加
- E2Eテスト 3シナリオ追加

## 影響範囲

- ユーザー設定画面
- ユーザーAPIエンドポイント
- 画像ストレージ

## 破壊的変更

なし

## テスト

- ユニットテスト: 全てパス
- E2Eテスト: プロフィール編集フロー完遂確認
- 手動テスト:
  - 各フィールドのバリデーション
  - 画像アップロード（サイズ、形式チェック）
  - エラーハンドリング

## スクリーンショット

（必要に応じて画像を添付）

## 関連

Fixes #123
Related to #456

## レビュー観点

特に以下の点をご確認ください:

- バリデーションロジックの妥当性
- 画像アップロードのセキュリティ
```

## まとめ

- **既存PRを参照**してスタイルを把握
- **ユーザー固有の規則**を尊重
- **簡潔かつ明確**に記述
- **背景と目的**を明示
- **装飾の使用**はプロジェクト規則に従う

---

**参考資料**:

- `dev-settings/claude/agent-docs/conventions/commit-messages.md` - コミットメッセージ規約
- `dev-settings/claude/agent-docs/workflows/code-review-guidelines.md` - レビューガイドライン
