---
import { getCollection } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import Header from "../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";

// ÊúÄÊñ∞„ÅÆarticles„Å®books„ÇíÂèñÂæó
const articles = (await getCollection("articles"))
  .filter((article) => article.data.published)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const books = (await getCollection("books")).filter((book) => book.data.published).slice(0, 3);
---

<!doctype html>
<html lang="ja">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
  </head>
  <body class="font-['Atkinson',sans-serif] bg-white text-gray-900">
    <Header />

    {/* „Éí„Éº„É≠„Éº„Çª„ÇØ„Ç∑„Éß„É≥ */}
    <section class="bg-gradient-to-br from-blue-50 to-purple-50 py-20">
      <div class="max-w-4xl mx-auto px-4 text-center">
        <h1 class="text-5xl md:text-6xl font-bold mb-6 text-gray-900">Connect Labo</h1>
        <p class="text-xl text-gray-600 mb-8">ÊäÄË°ìË®ò‰∫ã„Å®Êõ∏Á±ç„ÅßÂ≠¶„Å≥„ÇíÂÖ±Êúâ„Åô„ÇãÂ†¥ÊâÄ</p>
        <div class="flex gap-4 justify-center">
          <a
            href="/articles"
            class="px-6 py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-colors"
          >
            Articles „ÇíË™≠„ÇÄ
          </a>
          <a
            href="/books"
            class="px-6 py-3 bg-purple-600 text-white font-bold rounded-lg hover:bg-purple-700 transition-colors"
          >
            Books „ÇíË™≠„ÇÄ
          </a>
        </div>
      </div>
    </section>

    <main class="max-w-6xl mx-auto px-4 py-16">
      {/* ÊúÄÊñ∞„ÅÆArticles */}
      <section class="mb-16">
        <div class="flex justify-between items-center mb-8">
          <h2 class="text-3xl font-bold text-gray-900">ÊúÄÊñ∞„ÅÆ Articles</h2>
          <a href="/articles" class="text-blue-600 hover:underline"> „Åô„Åπ„Å¶Ë¶ã„Çã ‚Üí </a>
        </div>

        <div class="space-y-6">
          {
            articles.map((article) => (
              <article class="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                <a href={`/articles/${article.id}`} class="block">
                  <div class="flex items-start gap-3">
                    {article.data.emoji && <span class="text-3xl">{article.data.emoji}</span>}
                    <div class="flex-1">
                      <h3 class="text-xl font-bold mb-2 text-gray-900 hover:text-blue-600">
                        {article.data.title}
                      </h3>
                      <div class="flex flex-wrap gap-2 mb-2">
                        {article.data.topics.map((topic) => (
                          <span class="px-2 py-1 bg-gray-100 text-gray-700 text-sm rounded">
                            {topic}
                          </span>
                        ))}
                      </div>
                      <time class="text-sm text-gray-500">
                        {article.data.pubDate.toLocaleDateString("ja-JP")}
                      </time>
                    </div>
                  </div>
                </a>
              </article>
            ))
          }
        </div>
      </section>

      {/* ÊúÄÊñ∞„ÅÆBooks */}
      <section>
        <div class="flex justify-between items-center mb-8">
          <h2 class="text-3xl font-bold text-gray-900">ÊúÄÊñ∞„ÅÆ Books</h2>
          <a href="/books" class="text-purple-600 hover:underline"> „Åô„Åπ„Å¶Ë¶ã„Çã ‚Üí </a>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {
            books.map((book) => {
              const bookSlug = book.id.replace("/config.yml", "").replace("config.yml", "");

              return (
                <article class="border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow">
                  <a href={`/books/${bookSlug}`} class="block">
                    {/* „Ç´„Éê„ÉºÁîªÂÉè„Ç®„É™„Ç¢ */}
                    <div class="aspect-[3/4] bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center">
                      <span class="text-white text-6xl font-bold">üìö</span>
                    </div>

                    {/* Êú¨„ÅÆÊÉÖÂ†± */}
                    <div class="p-4">
                      <h3 class="text-xl font-bold mb-2 text-gray-900">{book.data.title}</h3>
                      <p class="text-sm text-gray-600 mb-3 line-clamp-2">{book.data.summary}</p>

                      {/* „Çø„Ç∞ */}
                      <div class="flex flex-wrap gap-2 mb-3">
                        {book.data.topics.slice(0, 3).map((topic) => (
                          <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                            {topic}
                          </span>
                        ))}
                      </div>

                      {/* Á´†Êï∞„Å®‰æ°Ê†º */}
                      <div class="flex justify-between items-center text-sm text-gray-500">
                        <span>{book.data.chapters.length} Á´†</span>
                        <span class="font-bold text-gray-900">
                          {book.data.price === 0 ? "ÁÑ°Êñô" : `¬•${book.data.price}`}
                        </span>
                      </div>
                    </div>
                  </a>
                </article>
              );
            })
          }
        </div>
      </section>
    </main>

    <Footer />
  </body>
</html>
